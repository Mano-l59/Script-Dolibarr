#! /bin/bash

#Connection à dattier

ssh -T mano.lemaire.etu@dattier.iutinfo.fr << 'EOF'

#Création et configuration des VMs

VM_LIST=("SAE4db" "SAE4dolibarr" "SAE4save")

for VM in "${VM_LIST[@]}"; do
    if vmiut lister | grep -q "$VM"; then
        vmiut supprimer "$VM"
    fi
    vmiut creer "$VM"
    vmiut demarrer "$VM"
done

IP_SAVE=$(vmiut info SAE4save | grep ip-potentielle1 | cut -d= -f2)
IP_DOLI=$(vmiut info SAE4dolibarr | grep ip-potentielle1 | cut -d= -f2)
IP_DB=$(vmiut info SAE4db | grep ip-potentielle1 | cut -d= -f2)

config_ip () {
    VM_NAME=$1
    STATIC_IP=$2

    vmiut exec "$VM_NAME" "cat > /etc/network/interfaces <<EONET
auto enp0s3
iface enp0s3 inet static
    address $STATIC_IP
    netmask 255.255.255.0
    gateway 10.42.173.1
EONET"

EOF
